# Example Generated /speckit.specify Prompt

> This is the draft prompt generated by GPT Mode 3 (Spec Readiness Assessment) for the "Bulk Import of Billing Codes" feature. The PM reviews and edits this before running it through spec-kit.

---

## Draft Prompt (as generated by GPT)

```
/speckit.specify

Feature: Bulk Import of Billing Codes via CSV

## Problem
Product managers managing the FX taxonomy experience significant time waste and data
entry errors when adding billing codes because the Admin UI only supports one-at-a-time
entry, resulting in 4+ hours of manual work per batch and a ~5% error rate requiring
audit trail cleanup.

Affected users: 5 PMs (primarily 3 FX PMs handling 40-60 codes per quarterly update).
Current impact: 15-20 hours/quarter across the team, plus ~10-15 error correction cycles
per quarter (each requiring deactivation + audit justification).

## Requirements

### Functional
- PM uploads a CSV file containing billing code definitions via API
- System validates ALL rows before processing any (all-or-nothing semantics)
- Each row specifies: code, description, taxonomy node code, billing rule ID,
  requiresApproval flag
- Validation checks:
  - Code format matches billing code pattern (BC-XXX-NNN)
  - Referenced taxonomy node exists and is ACTIVE
  - Referenced billing rule exists
  - No duplicate codes within the batch
  - No duplicate codes against existing billing codes in the system
- Valid codes are created in DRAFT status (or PENDING_APPROVAL if requiresApproval=true)
- Codes with requiresApproval=true enter the existing ApprovalWorkflow
- Each created billing code generates an individual audit event
- A batch-level audit event (BULK_IMPORT_INITIATED) is generated with the correlation ID
  and CSV hash
- Import produces a detailed report: success/failure per row with specific error messages,
  plus summary counts
- Maximum 500 billing codes per import
- Import is idempotent: re-uploading the same CSV after a successful import returns a
  conflict response with reference to the original import

### Non-Functional
- 500 codes must process in under 60 seconds (synchronous response)
- Endpoint requires RBAC role: BILLING_CODE_ADMIN
- [NEEDS CLARIFICATION]: Availability requirements for this batch endpoint (acceptable
  downtime window?)
- [NEEDS CLARIFICATION]: Concurrent import handling (should we allow multiple imports
  simultaneously?)

## Acceptance Criteria

- GIVEN a valid CSV with 100 billing codes referencing existing taxonomy nodes and
  billing rules
  WHEN the PM sends POST /api/v1/billing-codes/bulk with the CSV
  THEN all 100 codes are created in DRAFT status
  AND an import report is returned with 100 successes and 0 failures
  AND 100 individual audit events are emitted (one per code)
  AND 1 batch-level BULK_IMPORT_INITIATED audit event is emitted
  AND all audit events share the same correlation ID

- GIVEN a CSV with 50 codes where row 15 references a non-existent taxonomy node
  WHEN the PM sends POST /api/v1/billing-codes/bulk with the CSV
  THEN no billing codes are created (all-or-nothing)
  AND the import report shows 49 valid rows and 1 failure
  AND the failure for row 15 includes the error: "Taxonomy node [code] not found"
  AND no audit events are emitted (nothing was created)

- GIVEN a CSV with 30 codes where 5 have requiresApproval=true
  WHEN the PM sends POST /api/v1/billing-codes/bulk with the CSV
  THEN 25 codes are created in DRAFT status
  AND 5 codes are created in PENDING_APPROVAL status
  AND ApprovalWorkflows are initiated for the 5 pending codes

- GIVEN a CSV that was already successfully imported (same codes exist)
  WHEN the PM sends POST /api/v1/billing-codes/bulk with the same CSV
  THEN no new codes are created
  AND a 409 Conflict response is returned
  AND the response includes a reference to the original import

- GIVEN a CSV with 500 billing codes (maximum batch size)
  WHEN the PM sends POST /api/v1/billing-codes/bulk with the CSV
  THEN the response is returned within 60 seconds
  AND all 500 codes are created successfully

- GIVEN a CSV with 501 billing codes (exceeds maximum)
  WHEN the PM sends POST /api/v1/billing-codes/bulk with the CSV
  THEN a 400 Bad Request response is returned
  AND the error message states "Maximum 500 billing codes per import"
  AND no codes are created

## Constraints
- Must comply with Constitution Article I (API-First): new REST endpoint with OpenAPI spec
- Must comply with Constitution Article II (Domain Integrity): uses existing BillingCode
  entity model, references existing TaxonomyNode and BillingRule entities
- Must comply with Constitution Article III (Compliance by Design): individual audit events
  per code, batch-level audit event, correlation ID, SOX-compliant trail
- Must comply with Constitution Article IV (Test-First): contract tests, integration tests
  with test containers, acceptance tests from scenarios above
- Must comply with Constitution Article V (Backwards Compatibility): new endpoint only,
  no changes to existing endpoints
- Must comply with Constitution Article VI (Schema Governance): no schema changes to
  billing code table; may need new import_report or import_batch tracking table
- Must comply with Constitution Article VIII (Observability): structured logging for import
  operations, metrics for import count/duration/failure rate
- Must comply with Constitution Article IX (Security): RBAC enforcement, no secrets in
  CSV format

## Domain Context
Relevant entities: BillingCode, TaxonomyNode, BillingRule, ApprovalWorkflow, AuditEvent
See: Product Catalog domain model for entity definitions and relationships.

Key domain rules:
- Billing codes are immutable once created (errors require new code + deactivation of old)
- Taxonomy nodes are immutable once published (validation must check ACTIVE status)
- ApprovalWorkflow is triggered for codes with requiresApproval=true
- All state changes produce audit events with correlation IDs

## Open Items
- [NEEDS CLARIFICATION]: Confirm with Billing Engine team that bulk-created codes are
  fully compatible with their consumption patterns
- [NEEDS CLARIFICATION]: Determine if bulk deactivation by import ID is needed as a
  safety mechanism (proposed as future Tier 2 feature)
- [NEEDS CLARIFICATION]: Define availability requirements for the batch endpoint
- [NEEDS CLARIFICATION]: Define concurrent import handling policy
```

---

## PM Review Notes

Before running this through spec-kit, the PM (Sarah) should:

1. **Review all requirements** — are they accurate and complete?
2. **Check acceptance criteria** — do the Given/When/Then scenarios cover the critical paths?
3. **Resolve `[NEEDS CLARIFICATION]` items** where possible:
   - Billing Engine confirmation: send a message to the team, update the prompt with their response
   - Availability requirements: consult with tech lead, likely "standard business hours availability"
   - Concurrent imports: recommend "reject concurrent imports for the same PM" for V1 simplicity
4. **Verify constitution article references** — are any missing? (Article VII/YAGNI is implicitly satisfied by the tight scope)
5. **Edit for accuracy** — the GPT may have inferred details that need correction

The prompt is a **starting point**, not the final product. Sarah owns the accuracy of what goes into spec-kit.
